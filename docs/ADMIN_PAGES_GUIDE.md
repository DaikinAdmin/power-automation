# Admin Pages Management Guide

## Overview

Адміністративний інтерфейс для управління статичними сторінками з підтримкою мультимовності та редагування через Editor.js.

## Доступ до адмін-панелі

**URL:** `http://localhost:3000/{locale}/admin/pages`

**Вимоги:**
- Авторизований користувач з роллю `admin` або `employee`
- Сесія Better Auth

## Основні можливості

### 1. Перегляд всіх сторінок

На головній сторінці адмін-панелі `/admin/pages` відображаються:

- **Групування по slug:** Сторінки згруповані за slug (about-us, delivery, returns, contacts)
- **Переклади:** Для кожного slug показано доступні переклади (ua, en, pl, es)
- **Статус публікації:** Відображення чи сторінка опублікована чи є чернеткою
- **Дата оновлення:** Останнє оновлення кожної сторінки

### 2. Створення нової сторінки

**Маршрут:** `/admin/pages/new`

**Поля форми:**
- **Slug** (обов'язкове) - URL-friendly ідентифікатор (наприклад, `about-us`)
- **Locale** (обов'язкове) - Мова сторінки (ua, en, pl, es)
- **Title** (обов'язкове) - Заголовок сторінки
- **Is Published** - Чи опублікована сторінка
- **Content** - Контент через Editor.js

**Доступні блоки Editor.js:**
- Header (H1-H6)
- Paragraph
- List (ordered/unordered)
- Quote
- Code
- Warning
- Delimiter
- Table
- Checklist
- Raw HTML

**Створення через кнопку "Створити":**
Якщо певної локалізації немає для існуючого slug, можна швидко створити переклад, клікнувши на кнопку "Створити" в порожній картці локалі.

### 3. Редагування сторінки

**Маршрут:** `/admin/pages/[id]/edit`

**Можливості:**
- Редагування заголовка
- Зміна контенту через Editor.js
- Зміна статусу публікації
- Slug та locale не можна змінювати (тільки для перегляду)

**Збереження:**
Натисніть кнопку "Зберегти зміни" для оновлення сторінки.

### 4. Публікація/Приховування сторінки

На головній сторінці адмін-панелі кожна картка локалі має кнопку "Показати/Приховати":
- **Показати** - Встановлює `isPublished = true`
- **Приховати** - Встановлює `isPublished = false`

Тільки опубліковані сторінки доступні через публічний API.

### 5. Видалення сторінки

Кнопка з іконкою кошика на кожній картці локалі:
- Показує підтвердження
- Видаляє сторінку з бази даних
- Оновлює список автоматично

## Технічна архітектура

### Структура файлів

```
src/app/[locale]/admin/pages/
├── page.tsx              # Головна сторінка зі списком
├── new/
│   └── page.tsx          # Форма створення
└── [id]/
    └── edit/
        └── page.tsx      # Форма редагування
```

### Використані технології

1. **Editor.js**
   - Основний редактор: `@editorjs/editorjs`
   - Плагіни: header, list, paragraph, quote, code, warning, delimiter, table, checklist, raw
   - Dynamic import для SSR безпеки

2. **UI компоненти**
   - Card, Button, Input, Label, Switch, Select
   - Tailwind CSS для стилізації

3. **API endpoints**
   - `GET /api/admin/pages` - Отримання всіх сторінок
   - `POST /api/admin/pages` - Створення сторінки
   - `GET /api/admin/pages/[id]` - Отримання однієї сторінки
   - `PATCH /api/admin/pages/[id]` - Оновлення сторінки
   - `DELETE /api/admin/pages/[id]` - Видалення сторінки

### Формат даних

**Структура контенту Editor.js:**
```json
{
  "time": 1672531200000,
  "blocks": [
    {
      "type": "header",
      "data": {
        "text": "Заголовок",
        "level": 2
      }
    },
    {
      "type": "paragraph",
      "data": {
        "text": "Текст параграфу"
      }
    }
  ],
  "version": "2.29.0"
}
```

**Збереження в БД:**
Контент зберігається як JSON string в полі `content` таблиці `page_content`.

## Робочий процес

### Створення багатомовної сторінки

1. Перейдіть до `/admin/pages`
2. Натисніть "Створити нову сторінку"
3. Введіть slug (наприклад, `privacy-policy`)
4. Виберіть мову (наприклад, `ua`)
5. Введіть заголовок
6. Додайте контент через Editor.js
7. Натисніть "Зберегти"
8. Повторіть кроки 2-7 для інших мов, використовуючи той самий slug

### Альтернативний спосіб створення перекладу

1. Перейдіть до `/admin/pages`
2. Знайдіть картку зі slug, для якого потрібен переклад
3. Знайдіть порожню картку з потрібною локаллю
4. Натисніть "Створити" в порожній картці
5. Форма буде автоматично заповнена slug та locale
6. Додайте заголовок та контент
7. Зберіть

### Редагування існуючої сторінки

1. Перейдіть до `/admin/pages`
2. Знайдіть потрібну сторінку
3. Натисніть "Редагувати"
4. Внесіть зміни
5. Натисніть "Зберегти зміни"

### Публікація/Приховування

**Під час створення:**
- Увімкніть перемикач "Опублікувати відразу"

**Після створення:**
- На головній сторінці натисніть кнопку "Показати/Приховати"

## Особливості інтерфейсу

### Кольорова індикація статусу

- **Зелений бейдж** - Сторінка опублікована
- **Сірий бейдж** - Чернетка
- **Пунктирна рамка** - Переклад відсутній

### Адаптивний дизайн

- Мобільні пристрої: 1 колонка
- Планшети: 2 колонки
- Десктоп: 4 колонки (по одній для кожної мови)

### Навігація

- **Кнопка "Назад"** - Повернення до списку сторінок
- **Breadcrumbs** - Відображення поточної локації
- **Sidebar** - Пункт "Pages" в меню адмін-панелі

## Валідація

### На стороні клієнта

- Перевірка обов'язкових полів (slug, title, locale)
- Popup попередження при незаповнених полях

### На стороні сервера

- Перевірка унікальності комбінації slug + locale
- Валідація формату даних
- Авторизація та перевірка ролі

## Помилки та їх вирішення

### "Помилка при завантаженні сторінки"
**Причина:** Сторінка не знайдена або немає доступу  
**Рішення:** Перевірте ID сторінки в URL

### "Помилка при створенні сторінки"
**Причина:** Дублікат slug + locale або помилка валідації  
**Рішення:** Перевірте чи не існує вже така комбінація slug та locale

### "Помилка при оновленні статусу публікації"
**Причина:** Проблеми з мережею або відсутність авторизації  
**Рішення:** Перевірте з'єднання та авторизацію

### Editor.js не завантажується
**Причина:** Проблеми з динамічним імпортом  
**Рішення:** Перезавантажте сторінку, очистіть кеш браузера

## Приклади використання

### Приклад 1: Створення сторінки "Про нас"

```
Slug: about-us
Locale: ua
Title: Про нас
Content:
  - Header (H1): Про компанію
  - Paragraph: Ми - провідна компанія в галузі...
  - List: 
    * Пункт 1
    * Пункт 2
  - Delimiter
  - Header (H2): Наша місія
  - Paragraph: Наша місія - надавати...
```

### Приклад 2: Створення сторінки "Доставка"

```
Slug: delivery
Locale: ua
Title: Умови доставки
Content:
  - Header (H1): Доставка та оплата
  - Warning: Важливо! Доставка здійснюється тільки по Україні
  - Table: 
    | Спосіб | Термін | Ціна |
    | Нова Пошта | 1-2 дні | 50 грн |
    | Укрпошта | 3-5 днів | 30 грн |
  - Checklist:
    ☐ Доставка по Києву - безкоштовно від 1000 грн
    ☐ Самовивіз з офісу
```

## Інтеграція з frontend

Створені сторінки автоматично доступні за URL:
```
/{locale}/{slug}

Приклади:
/ua/about-us
/en/delivery
/pl/returns
/es/contacts
```

Рендеринг здійснюється через компонент `EditorJSRenderer` на стороні клієнта.

## Best Practices

1. **Консистентність slug:** Використовуйте однакові slug для всіх мов
2. **Осмислені slug:** Використовуйте зрозумілі URL (about-us, не page1)
3. **Регулярні бекапи:** Створюйте резервні копії контенту
4. **Перевірка перед публікацією:** Тестуйте сторінки як чернетки перед публікацією
5. **Версіонування:** Зберігайте історію змін (майбутня фіча)

## Майбутні покращення

- [ ] Версіонування контенту
- [ ] Попередній перегляд перед публікацією
- [ ] Завантаження зображень
- [ ] Масове редагування
- [ ] Експорт/Імпорт контенту
- [ ] Пошук та фільтрація сторінок
- [ ] Копіювання контенту між локалями
- [ ] Історія змін та rollback
- [ ] SEO поля (meta description, keywords)
- [ ] Планування публікації

## Підтримка

При виникненні проблем:
1. Перевірте консоль браузера на помилки
2. Перевірте логи сервера
3. Переконайтеся в наявності авторизації
4. Перевірте доступ до API endpoints
